---
layout: post
title:  "Spring Cloud学习记录：Eureka 注册中心"
date:   2019-06-17 17:04:00 +0200
categories: SpringCloud
excerpt: Eureka是Netflix开源的一款提供服务注册和发现的产品，它提供了完整的Service Registry和Service Discovery实现。也是springcloud体系中最重要最核心的组件之一。
tagg: Spring
---

# Eureka

Eureka是Netflix开源的一款提供服务注册和发现的产品，它提供了完整的Service Registry和Service Discovery实现。也是springcloud体系中最重要最核心的组件之一。

## idea创建新项目
- 选择Spring Initializr(JDK一定要选1.8版本的！！坑！)
- 输入名字后下一步
- 选Spring Cloud Discovery->Eureka Server
- 新建完毕

## 入口类中添加@EurekaServer注解

```
@SpringBootApplication
@EnableEurekaServer
public class EurekaApplication {

    public static void main(String[] args) {
        SpringApplication.run(EurekaApplication.class, args);
    }

}
```

## 修改配置文件application.yml:

```
server:
  port: 8761
  
eureka:
  client:
    fetch-registry: false
    service-url:
      defaultZone: http://localhost:8761/eureka/
    register-with-eureka: false
    
spring:
  application:
    name: eureka
```

- `eureka.client.register-with-eureka`：表示是否将自己注册到EurekaServer，默认为true。
- `eureka.client.fetch-registry`：表示是否从EurekaServer获取注册信息，默认为true。
- `eureka.client.serviceUrl.defaultZone`：设置与Eureka Server交互的地址，查询服务和注册服务都需要依赖这个地址。默认是http://localhost:8761/eureka ；多个地址可使用 , 分隔。

默认设置下，该服务注册中心也会将自己作为客户端来尝试注册它自己，所以我们需要禁用它的客户端注册行为。

## 启动项目
可以看到Instances currently registered with Eureka栏目中还没有注册的服务。

## 打包
因为注册中心在整体项目中是每次都需要启动的，然而如果每次都到idea去启动的话会相对麻烦，所以将它打成jar包运行会方便很多

### 打包：
命令行定位到eureka项目的目录后输入命令：
```
mvn clean package
```

**PS:这里如果报错：`No compiler is provided in this environment. Perhaps you are running on a JRE rather than a JDK?`**

**原因：**
项目使用版本的jdk和maven环境使用的jdk版本不一样。仔细检查：
- idea项目使用的jdk

> Setting->Build,Execution,Deployment->Compiler->java Compiler：改好版本  
> 右键项目->F4->Project：更改Project SDK和Project language level  
> 右键项目->F4->Project：更改好版本

- 系统环境变量中java的版本，要和idea使用的是同一个JDK！！

### 启动jar包

```
java -jar target/eureka-0.0.1-SNAPSHOT.jar
```
可以通过ctrl+c停止程序

### 后台运行

#### macOS下:
```
nohup java -jar target/eureka-0.0.1-SNAPSHOT.jar > /dev/null 2>&1 &
```
会返回进程PID

也可通过指令获得PID：

```
ps -ef |grep eureka
```

通过指令终止进程：

```
kill -9 PID
```

#### Win下

新建bat批处理文件 并启动：
```
@echo off
start javaw -jar xxxxxxxx-SNAPSHOT.jar
exit
```
建议jar包与批处理文件处于同一目录，启动后会生成log文件，即项目日志

在产生的log文件中查看PID，然后到任务管理器的进程找到PID可终止进程

<br /><br /><br /><br />

> github: https://github.com/Hikiy  
> 作者：Hiki  
> 创建日期：2019.06.17  
> 更新日期：2019.06.17
